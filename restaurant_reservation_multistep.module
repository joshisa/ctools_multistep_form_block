<?php

/**
 * @file
 * This is a basic block module that provides an Ajax dependent dropdown form
 * Author:  joshisa@us.ibm.com
 */


/*
 * Implementation of hook_form_alter()
 */
function restaurant_reservation_multistep_form_alter(&$form, &$form_state, $form_id){
  //dsm($form);
  //dsm($form_id);
  // Check when the right form is passed
  if ($form_id == 'eck__entity__form_add_reservation_reservation') {
    $options_first = _first_dropdown_options();
    $selected = isset($form_state['values']['field_reservation_cake_type'][$form['field_reservation_cake_type']['#language']][0]['value']) ? $form_state['values']['field_reservation_cake_type'][$form['field_reservation_cake_type']['#language']][0]['value'] : key($options_first);
    /* Add the check box
    $form['certify'] = array(
      '#type' => 'checkbox',
      '#title' => t('I certify that this is fresh!'),
    );
    */
    // drupal_set_message('<pre>'. print_r($form_state['values']['field_reservation_cake_type'][$form['field_reservation_cake_type']['#language']][0]['value'], TRUE) .'</pre>');
    // drupal_set_message('<pre>'. print_r($form_state, 1) .'</pre>');
    $form["field_reservation_cake_type"][$form["field_reservation_cake_type"]['#language']]['#ajax'] = array(
      // When 'event' occurs, Drupal will perform an ajax request in the
      // background. Usually the default value is sufficient (eg. change for
      // select elements), but valid values include any jQuery event,
      // most notably 'mousedown', 'blur', and 'submit'.
      'event' => 'change',
      'callback' => 'restaurant_reservation_multistep_cake_type_callback',
      'wrapper' => 'cake-size-replace',
    );

    $form['field_reservation_cake_size'][$form['field_reservation_cake_type']['#language']]['#description'] = t('Cake Sizing');
    $form['field_reservation_cake_size'][$form['field_reservation_cake_type']['#language']]['#prefix'] = '<div id="cake-size-replace">';
    $form['field_reservation_cake_size'][$form['field_reservation_cake_type']['#language']]['#suffix'] = '</div>';
    $form['field_reservation_cake_size'][$form['field_reservation_cake_type']['#language']]['#options'] = _second_dropdown_options($selected);
    $form['field_reservation_cake_size'][$form['field_reservation_cake_type']['#language']]['#default'] = 0;
    $form['field_reservation_cake_size'][$form['field_reservation_cake_type']['#language']]['#required'] = TRUE;
    $form['field_reservation_cake_size'][$form['field_reservation_cake_type']['#language']]['#validated'] = TRUE;
    $form['field_reservation_cake_size'][$form['field_reservation_cake_type']['#language']]['#ajax'] = array(
      // When 'event' occurs, Drupal will perform an ajax request in the
      // background. Usually the default value is sufficient (eg. change for
      // select elements), but valid values include any jQuery event,
      // most notably 'mousedown', 'blur', and 'submit'.
      'event' => 'change',
      'callback' => 'restaurant_reservation_multistep_cake_size_callback',
      'wrapper' => 'cake-flavor-replace',
    );

    $form['field_reservation_cake_flavors'][$form['field_reservation_cake_type']['#language']]['#description'] = t('Cake Sizing');
    $form['field_reservation_cake_flavors'][$form['field_reservation_cake_type']['#language']]['#prefix'] = '<div id="cake-flavor-replace">';
    $form['field_reservation_cake_flavors'][$form['field_reservation_cake_type']['#language']]['#suffix'] = '</div>';
    $form['field_reservation_cake_flavors'][$form['field_reservation_cake_type']['#language']]['#options'] = _third_dropdown_options($selected);
    $form['field_reservation_cake_flavors'][$form['field_reservation_cake_type']['#language']]['#default'] = 0;
    $form['field_reservation_cake_flavors'][$form['field_reservation_cake_type']['#language']]['#required'] = TRUE;
    $form['field_reservation_cake_flavors'][$form['field_reservation_cake_type']['#language']]['#validated'] = TRUE;
    $form['field_reservation_cake_flavors'][$form['field_reservation_cake_type']['#language']]['#ajax'] = array(
      // When 'event' occurs, Drupal will perform an ajax request in the
      // background. Usually the default value is sufficient (eg. change for
      // select elements), but valid values include any jQuery event,
      // most notably 'mousedown', 'blur', and 'submit'.
      'event' => 'change',
      'callback' => 'restaurant_reservation_multistep_cake_flavor_callback',
      'wrapper' => 'cake-filling-replace',
    );


    $form['field_reservation_cake_fillings'][$form['field_reservation_cake_type']['#language']]['#description'] = t('Cake Filling');
    $form['field_reservation_cake_fillings'][$form['field_reservation_cake_type']['#language']]['#prefix'] = '<div id="cake-filling-replace">';
    $form['field_reservation_cake_fillings'][$form['field_reservation_cake_type']['#language']]['#suffix'] = '</div>';
    $form['field_reservation_cake_fillings'][$form['field_reservation_cake_type']['#language']]['#options'] = _fourth_dropdown_options($selected);
    $form['field_reservation_cake_fillings'][$form['field_reservation_cake_type']['#language']]['#default'] = 0;
    $form['field_reservation_cake_fillings'][$form['field_reservation_cake_type']['#language']]['#required'] = TRUE;
    $form['field_reservation_cake_fillings'][$form['field_reservation_cake_type']['#language']]['#validated'] = TRUE;
    $form['field_reservation_cake_fillings'][$form['field_reservation_cake_type']['#language']]['#ajax'] = array(
      // When 'event' occurs, Drupal will perform an ajax request in the
      // background. Usually the default value is sufficient (eg. change for
      // select elements), but valid values include any jQuery event,
      // most notably 'mousedown', 'blur', and 'submit'.
      'event' => 'change',
      'callback' => 'restaurant_reservation_multistep_cake_filling_callback',
      'wrapper' => 'cake-icing-replace',
    );

    $form['field_reservation_cake_icing'][$form['field_reservation_cake_type']['#language']]['#description'] = t('Cake Icing');
    $form['field_reservation_cake_icing'][$form['field_reservation_cake_type']['#language']]['#prefix'] = '<div id="cake-icing-replace">';
    $form['field_reservation_cake_icing'][$form['field_reservation_cake_type']['#language']]['#suffix'] = '</div>';
    $form['field_reservation_cake_icing'][$form['field_reservation_cake_type']['#language']]['#options'] = _fifth_dropdown_options($selected);
    $form['field_reservation_cake_icing'][$form['field_reservation_cake_type']['#language']]['#default'] = 0;
    $form['field_reservation_cake_icing'][$form['field_reservation_cake_type']['#language']]['#required'] = TRUE;
    $form['field_reservation_cake_icing'][$form['field_reservation_cake_type']['#language']]['#validated'] = TRUE;
    $form['field_reservation_cake_icing'][$form['field_reservation_cake_type']['#language']]['#ajax'] = array(
      // When 'event' occurs, Drupal will perform an ajax request in the
      // background. Usually the default value is sufficient (eg. change for
      // select elements), but valid values include any jQuery event,
      // most notably 'mousedown', 'blur', and 'submit'.
      'event' => 'change',
      'callback' => 'restaurant_reservation_multistep_cake_icing_callback',
      'wrapper' => 'cake-design-replace',
    );

    $form['field_reservation_cake_design'][$form['field_reservation_cake_type']['#language']]['#description'] = t('Cake Design');
    $form['field_reservation_cake_design'][$form['field_reservation_cake_type']['#language']]['#prefix'] = '<div id="cake-design-replace">';
    $form['field_reservation_cake_design'][$form['field_reservation_cake_type']['#language']]['#suffix'] = '</div>';
    $form['field_reservation_cake_design'][$form['field_reservation_cake_type']['#language']]['#options'] = _sixth_dropdown_options($selected);
    $form['field_reservation_cake_design'][$form['field_reservation_cake_type']['#language']]['#default'] = 0;
    $form['field_reservation_cake_design'][$form['field_reservation_cake_type']['#language']]['#required'] = TRUE;
    $form['field_reservation_cake_design'][$form['field_reservation_cake_type']['#language']]['#validated'] = TRUE;
/*
    $form['field_reservation_cake_design'][$form['field_reservation_cake_design']['#language']]['#ajax'] = array(
      // When 'event' occurs, Drupal will perform an ajax request in the
      // background. Usually the default value is sufficient (eg. change for
      // select elements), but valid values include any jQuery event,
      // most notably 'mousedown', 'blur', and 'submit'.
      'event' => 'change',
      'callback' => 'restaurant_reservation_multistep_cake_icing_callback',
      'wrapper' => 'cake-designtype-replace',
    );
     */

  }
}


function restaurant_reservation_multistep_cake_type_callback($form, $form_state) {
  return $form["field_reservation_cake_size"];
}

function restaurant_reservation_multistep_cake_size_callback($form, $form_state) {
  $commands[] = ajax_command_insert('#cake-flavor-replace', drupal_render($form['field_reservation_cake_flavors']));
  return array('#type' => 'ajax', '#commands' => $commands);
}

function restaurant_reservation_multistep_cake_flavor_callback($form, $form_state) {
  $commands[] = ajax_command_insert('#cake-filling-replace', drupal_render($form['field_reservation_cake_fillings']));
  return array('#type' => 'ajax', '#commands' => $commands);
}

function restaurant_reservation_multistep_cake_filling_callback($form, $form_state) {
  $commands[] = ajax_command_insert('#cake-icing-replace', drupal_render($form['field_reservation_cake_icing']));
  return array('#type' => 'ajax', '#commands' => $commands);
}

function restaurant_reservation_multistep_cake_icing_callback($form, $form_state) {
  $commands[] = ajax_command_insert('#cake-design-replace', drupal_render($form['field_reservation_cake_design']));
  return array('#type' => 'ajax', '#commands' => $commands);
}

function _first_dropdown_options() {
  // drupal_map_assoc() just makes an array('String' => 'String'...).
  return drupal_map_assoc(
  array(
    t('- Select a value -'),
    t('Sheet'),
    t('Round'),
    t('Pull-Apart Cupcake'),
    t('Dancer'),
    t('Brownie Sandwich'),
  )
  );
}

function _second_dropdown_options($key = '') {
  $options = array(
    t('Sheet') => drupal_map_assoc(
    array(
      t('- Select a value -'),
      t('1/4 (16-24 people)'),
      t('1/2 (32-48 people)'),
      t('Full (64-96 people)'),
    )
    ),
    t('Dancer') => drupal_map_assoc(
    array(
      t('- Select a value -'),
      t('1/4 (16-24 people)'),
      t('1/2 (32-48 people)'),
      t('Full (64-96 people)'),
    )
    ),
    t('Round') => drupal_map_assoc(
    array(
      t('- Select a value -'),
      t('Single Layer (6-10 people)'),
      t('Double Layer (8-12 people)'),
    )
    ),
    t('Pull-Apart Cupcake') => drupal_map_assoc(
    array(
      t('- Select a value -'),
      t('Six (6)'),
      t('Twelve (12)'),
      t('Twenty-Four (24)'),
    )
    ),
    t('Brownie Sandwich') => drupal_map_assoc(
    array(
      t('- Select a value -'),
      t('Six (6)'),
      t('Twelve (12)'),
      t('Twenty-Four (24)'),
    )
    ),
  );
  if (isset($options[$key])) {
    return $options[$key];
  }
  else {
    return array(t('- Select a value -'));
  }
}

function _third_dropdown_options($key = '') {
  $options = array(
    t('Sheet') => drupal_map_assoc(
    array(
      t('- Select a value -'),
      t('White'),
      t('Chocolate'),
      t('Marble'),
      t('Yellow'),
      t('Red Velvet')
    )
    ),
    t('Dancer') => drupal_map_assoc(
    array(
      t('- Select a value -'),
      t('White'),
      t('Chocolate'),
      t('Marble'),
      t('Yellow'),
      t('Red Velvet')
    )
    ),
    t('Round') => drupal_map_assoc(
    array(
      t('- Select a value -'),
      t('White'),
      t('Chocolate'),
      t('Marble'),
      t('Red Velvet')
    )
    ),
    t('Pull-Apart Cupcake') => drupal_map_assoc(
    array(
      t('- Select a value -'),
      t('White'),
      t('Chocolate'),
      t('Variety'),
    )
    ),
    t('Brownie Sandwich') => drupal_map_assoc(
    array(
      t('- Select a value -'),
      t('White'),
      t('Chocolate'),
      t('Variety'),
    )
    ),
  );
  if (isset($options[$key])) {
    return $options[$key];
  }
  else {
    return array(t('- Select a value -'));
  }
}

function _fourth_dropdown_options($key = '') {
  $options = array(
    t('Sheet') => drupal_map_assoc(
    array(
      t('Bavarian Cream'),
      t('Raspberry'),
      t('Lemon'),
      t('Cherry'),
      t('Chocolate'),
      t('Cream Cheese'),
      t('Strawberry'),
      t('White'),
    )
    ),
    t('Dancer') => drupal_map_assoc(
    array(
      t('Bavarian Cream'),
      t('Raspberry'),
      t('Lemon'),
      t('Chocolate'),
      t('White'),
    )
    ),
    t('Round') => drupal_map_assoc(
    array(
      t('Bavarian Cream'),
      t('Raspberry'),
      t('Lemon'),
      t('Cherry'),
      t('Chocolate'),
      t('Cream Cheese'),
      t('Strawberry'),
      t('White'),
    )
    ),
    t('Pull-Apart Cupcake') => drupal_map_assoc(
    array(
      t('N/A'),
    )
    ),
    t('Brownie Sandwich') => drupal_map_assoc(
    array(
      t('Vanilla Ice Cream'),
      t('Vanilla Yogurt'),
      t('Chocolate Vanilla Swirl'),
      t('Strawberry Ice Cream'),
      t('French Vanilla Ice Cream'),
    )
    ),
  );
  if (isset($options[$key])) {
    return $options[$key];
  }
  else {
    return array(t('- Select a value -'));
  }
}

function _fifth_dropdown_options() {
  // drupal_map_assoc() just makes an array('String' => 'String'...).
  return drupal_map_assoc(
  array(
    t('White Icing (Ask about other colors)'),
    t('Chocolate Icing'),
    t('Whipped Topping'),
    t('Cream Cheese Icing'),
  )
  );
}

function _sixth_dropdown_options() {
  // drupal_map_assoc() just makes an array('String' => 'String'...).
  return drupal_map_assoc(
  array(
    t('Character Design'),
    t('Theme Design'),
  )
  );
}
